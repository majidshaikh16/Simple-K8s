node{
    stage('checkout to SCM'){
        checkout scm
    }

    stage('compile and test'){
        def mvn = tool name: 'maven3', type: 'maven'
        sh 'cd SimpleWeb/'
        sh "${mvn}/bin/mvn package"
    }

    stage('Build and Push'){    
        def dockerfile = 'Dockerfile'
            // sh 'docker build -t majidshaikh16/simple-web -f ./SimpleWeb/${dockerfile} ./SimpleWeb/'
        docker.withRegistry('https://registry.hub.docker.com', 'docker-hub-creds') {
            def customImage = docker.build("majidshaikh16/simple-web1","-f ./SimpleWeb/${dockerfile} ./SimpleWeb/")
            customImage.push()
            customImage.push('staging')        
        }

    }
    
}